#! /bin/sh 

HOME=`pwd`
userid=guest
maildir=$HOME/Mail/$userid
if [ ! -d $HOME/Mail ];then
  mkdir $HOME/Mail
fi
if [ ! -d $HOME/Mail/$userid ];then
  mkdir $HOME/Mail/$userid
fi
if [ ! -f $HOME/Mail/$userid/mailcount ];then
  echo "0" > $HOME/Mail/$userid/mailcount
fi


top() {
pmenu=top
cmenu=top
while [ $menuname = $cmenu ]
do
        clear
        echo "

   1. È¸¿øÁ¤º¸(users)
   
   2. °Ô½ÃÆÇ(board)

   3. ÀÚ·á½Ç(pbs)

   4. ÆíÁö°ü¸®(mails)

   5. ´ëÈ­¹æ(chat) 
"
        getop "¹øÈ£/¸í·É(H,T,P,GO,Z,WH,PF,X) >>"
if [ $x = 1 ] 
        then
        menuname=users 
        elif [ $x = 2 ]
                then
                menuname=board 
                elif [ $x = 3 ]
                        then
                        menuname=pbs
                        elif [ $x = 4 ]
                                then
                                menuname=mails
                        elif [ $x = 5 ]
                                then
                                menuname=chat
fi
done
}


mails() {

pmenu=top
cmenu=mails
while [ $menuname = $cmenu ]
do
clear
echo "

          ¡¡                                      ¡¡
          ¡¡        1. ÆíÁö ¹Þ±â(RMAIL)           ¡¡
          ¡¡                                      ¡¡
          ¡¡        2. ÆíÁö º¸³»±â(WMAIL)         ¡¡
          ¡¡                                      ¡¡
"

getop "¹øÈ£/¸í·É(H,T,P,GO,Z,WH,PF,X) >>" 

if [ "$x" = "1" ] 
        then
        menuname=rmail 
        elif [ "$x" = "2" ]
                then
                menuname=wmail 
fi
done
}

rmail()
{
        pmenu=mails
        cmenu=rmail
        cdir=$maildir
        view mailheader 
}

view() {

while [ $menuname = $cmenu ]
do
        clear
        echo " ¹ß½ÅÀÎ	    Å©±â  ÀÏÀÚ ½Ã°£ ¹øÈ£    Á¦¸ñ "
        echo " ------------------------------------------------------------------------------"
 
        more $cdir/$1 2> /dev/null

        getop "¹øÈ£/¸í·É(H,T,P,F,B,LS,LD,LT,PR,W,D,EM,GO,Z,WH,PF,X) >>"
        if [ -f $cdir/$x ]
                then
                filenum=$cdir/$x
                pmenu=$menuname
                menuname=readfile
        fi
done

}


readfile (){
        cmenu=readfile
        while [ $menuname = $cmenu ]
        do
                clear
                more $filenum 2> /dev/null
                getop "¹øÈ£/¸í·É(H,T,P,F,B,A,N,RE,GO,Z,WH,PF,X) >>"
        done
}

wmail ()
{
        pmenu=mails
        cmenu=wmail

        clear
        echo -n "ÆíÁö¸¦ ¹ÞÀ» »ç¶÷ : "
        read xid
        echo -n "Á¦¸ñÀ» ³Ö¾î ÁÖ¼¼¿ä. Ãë¼ÒÇÏ·Á¸é <Enter> : "
        read title
        echo -n "editor¸¦ ¼±ÅÃÇÏ¼¼¿ä...
        1. vi editor   0. Ãë¼Ò : "
        read x
        if [ "$x" = 1 ]
        then 
                cd $HOME/Mail/$xid
                tempnum=`cat mailcount`
                mailnum=`expr $tempnum + 1`
                echo $mailnum > mailcount
                vi $mailnum
                tempheader="`ls -al $mailnum 2> /dev/null | cut -c35-55`" 
                echo     "$xid	$tempheader	$mailnum $title"    >> mailheader
                clear
                echo -n "
                ÆíÁö¸¦ º¸³Â½À´Ï´Ù. <Enter>¸¦ ´©¸£¼¼¿ä."
                read x
                cd $HOME
        fi
        menuname=$pmenu 
}



getop() {
echo "[23H"
while [ $menuname = $cmenu ]
do
echo -n "$1"
read x
compile $x
done
}


help() {
echo "
¹øÈ£ : ÇØ´ç¹øÈ£ÀÇ ±Û ÀÐ±â
H    : µµ¿ò¸»
T    : ÃÊ±âÈ­¸éÀ¸·Î ÀÌµ¿
P    : »óÀ§ ¸Þ´º·Î ÀÌµ¿
PR   : ÇØ´ç ±Û ÀÏ°ý Ãâ·Â    (»ç¿ë¹ý : pr + ±Û¹øÈ£)
W    : ±Û¾²±â 
D    : ÇØ´ç¹øÈ£ÀÇ ±Û »èÁ¦   (»ç¿ë¹ý : d + ±Û¹øÈ£)
GO   : °Ô½ÃÆÇÀ¸·Î Á÷Á¢ ÀÌµ¿ (»ç¿ë¹ý : go + °Ô½ÃÆÇ¸í)
Z    : È­¸é Á¤¸®
WH   : ÇöÀç Á¢¼ÓÀÚ ¸í´Ü
X    : Á¢¼Ó Á¾·á
"
}

compile(){ 
case $1 in
        h|H)
                help;;
        p|P)
                cmenu=bottom
                menuname=$pmenu;;
        x|X)    
                exit;;
        [1-9]*) 
                cmenu=bottom;;
        t|T)
                cmenu=bottom
                menuname=top;;
        w|W)
                vi temp.txt;;
        wh|WH)
                w -h|cut -c1-8|sort|uniq;;
        go|GO)
                cmenu=bottom
                menuname=$2
                x=go;;
        pr|PR) 
                cat $2;;
        d|D)
                rm $2
                cmenu=bottom;;
        z|Z)
                cmenu=bottom;;
 esac
}


bbs (){
menuname=top

while [ 1 ]
do
$menuname
done

}

bbs


